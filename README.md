# Traffic Flow Prediction Based on Temporal Attention and Multi-Graph Adjacency Fusion Using DynamicChebNet

  Thank you for reading this document!  
  If you have any questions or suggestions, please feel free to reach out:
  
  **Email**: [357238107@qq.com](mailto:357238107@qq.com)

  **Paper**: [TMDCN](https://www.nature.com/articles/s41598-025-12598-z?utm_source=rct_congratemailt&utm_medium=email&utm_campaign=oa_20251007&utm_content=10.1038/s41598-025-12598-z)

## Figure

<div style="text-align: center;">
  <img src="./figure/Framework.png" alt="Framework" width="600"/>
  <p style="text-align:center;">Figure 1: Framework of the model</p>
</div>

<div style="text-align: center;">
  <img src="./figure/Temporal_Feature_Extraction_Block.png" alt="Temporal Feature Extraction Block" width="600"/>
  <p style="text-align:center;">Figure 2: Temporal Feature Extraction Block</p>
</div>

## Requirement

The experiments were conducted using an RTX 3090GPU for training, based on Ubuntu 20.04, with Pytorch 2.0.0 and Python 3.8 for implementing the TMDCN model.

Please make sure you have installed Python and PyTorch correctly. Then you can install all the dependencies with the following command by pip:
```shell
pip install -r requirements.txt
```

To install pytorch-geometric, follow these steps:<br>
- make sure to choose the correct version of PyTorch based on your CUDA version if you're using a GPU.
- install the four dependencies in sequence: torch_scatter, torch_sparse, torch_cluster, and torch_spline_conv. Go to [https://data.pyg.org/whl/](https://data.pyg.org/whl/) and download the .whl file.
- enter the installation directories of the above four dependencies and execute the command (for example, replace the specific file name) :
  ```shell
  pip install torch_scatter-2.0.7-cp37-cp37m-win_amd64.whl
  ```
- install torch_geometric:
  ```shell
  pip install torch_geometric
  ```

## Structure

``` 
|- TMDCN
    |- configuration (Configuration File, you can configure all parameters related to training)
        - PEMS04.conf
        - PEMS08.conf
    |- dataset (create folder)
        |- PEMS04
            - PEMS04.csv (Download File, download the corresponding dataset and place it in this folder)
            - PEMS04.npz (Download File, download the corresponding dataset and place it in this folder)
            - PEMS04_cost_adj_matrix.pt (Generated File, generated by running the static_adj_matrix.py)
            - PEMS04_similarity_adj_matrix.pt (Generated File, generated by running the static_adj_matrix.py)
            - PEMS04_w1_d1_h1.npz (Generated File, generated by running the feature_matrix.py)
        |- PEMS08 (Same as PEMS04)
            - ...
    |- lib
        |- config_loader.py (Set command-line parameters and read configuration files)
        |- cost_adj_matrix.py
        |- dataloader.py (Load and preprocess the dataset for training and evaluation)
        |- metrics.py (Define evaluation metrics, such as MAE, MAPE, RMSE, for model performance)
        |- similarity_adj_matrix.py
        |- utils.py
    |- model
        - ...
    |- run (Directory containing training-related outputs and configurations)
        |- train
            |- exp-1 (training name)
                |- tensorboard
                    - ...
                |- log
                    - ...
                |- checkpoint
                    - ...
                - PEMS04_config_backup.conf
            |- exp-2
            |- exp-3
            |- ...
    - feature_matrix.py
    - static_adj_matrix.py
    - train.py
```

## Dataset

- The dataset link is [Google Drive](https://drive.google.com/drive/folders/1qjtk8cjvnpc5M86muWlZQUXt6LUEQACr?usp=sharing) or [Caltrans PeMS](https://pems.dot.ca.gov./).
- Taking PEMS04 as an example, you must place the downloaded PEMS04.csv and PEMS04.npz files into the PEMS04 folder under the dataset directory.
- Run feature_matrix.py and static_adj_matrix.py to generate PEMS04_cost_adj_matrix.pt, PEMS04_similarity_adj_matrix.pt, and PEMS04_w1_d1_h1.npz.
> feature_matrix.py based on the open-source project: [ASTGCN-2019-pytorch](https://github.com/guoshnBJTU/ASTGCN-2019-pytorch)

## Train

- on PEMS04 dataset:
  ```shell
  python train.py --dataset PEMS04
  ```
- on PEMS08 dataset:
  ```shell
  python train.py --dataset PEMS08
  ```

- If you want to continue with the previous training, please modify the parameters of the configuration file (for example, replace the specific training name) :
  ```
  continue_training = True
  continue_training_name = exp-1
  ```

## Cite
If you find the paper useful, please cite as following:
```
@article{zhang2025traffic,
  title={Traffic flow prediction based on temporal attention and multi-graph adjacency fusion using DynamicChebNet},
  author={Zhang, Jingbao and Cheng, Junbing and Li, Fujia},
  journal={Scientific Reports},
  volume={15},
  number={1},
  pages={34864},
  year={2025},
  publisher={Nature Publishing Group UK London}
}
```
